{% extends "base.html" %}

{% load staticfiles %}
{% load bootstrap4 %}
{% load bittersweet_querystring %}

{% block prefetch %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/themes/default.css" />
{% endblock prefetch %}

{% block title %}User Profile{% endblock title %}

{% block breadcrumbs %}
    <li class="breadcrumb-item active" aria-current="page">Account</li>
{% endblock breadcrumbs %}

{% block main_content %}
    <div class="container bg-main profile-page">
        <ul class="nav nav-tabs mb-4" id="nav-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link font-weight-bold{% if active_tab == 'contributions' %} active" aria-selected="true{% else %} aria-selected="false{% endif %}" id="contributions-tab" data-toggle="tab" data-target="#contributions" type="button" role="tab">My Contributions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link font-weight-bold{% if active_tab == 'recent' %} active" aria-selected="true{% else %} aria-selected="false{% endif %}" id="recent-tab" data-toggle="tab" data-target="#recent" type="button" role="tab" aria-controls="recent" href="#recent">Recent Pages Worked On</a>
            </li>
            <li class="nav-item">
                <a class="nav-link font-weight-bold{% if active_tab == 'account' %} active" aria-selected="true{% else %} aria-selected="false{% endif %}" id="account-tab" data-toggle="tab" data-target="#account" type="button" role="tab" href="#account">Account Settings</a>
                    </li>
                    </ul>
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade{% if active_tab == 'account' %} show active{% endif %}" id="account" role="tabpanel" aria-labelledby="account-tab">
                            <div class="row justify-content-start">
                                <div class="col-12 col-md-10">
                                    <h2>Account Settings</h2>
                                    <div class="mb-2">
                                        <span class="font-weight-bold">User Name</span>: {{ user.username }}
                                            </div>
                                            <div class="mt-1 mb-3">
                                                <span class="font-weight-bold">Email address</span>: {{ user.email }}
                                                    </div>
                                                    </div>
                                                    <div class="col-12 col-md-10 py-3 change-options">
                                                        <form class="form needs-validation" action="{% url 'user-profile' %}" method="POST" enctype="multipart/form-data" novalidate>
                                                            {% csrf_token %}

                                                            <div class="input-group mb-3 email-address">
                                                                <input type="email" name="email" placeholder="Change your email address" class="form-control font-italic" title="" required="" id="id_email" required>
                                                                    <div class="input-group-append">
                                                                        {% bootstrap_button "Save Change" button_type="submit" button_class="btn btn-primary rounded-0" %}
                                                                        </div>
                                                                        {% if valid %}
                                                                            <div class="mt-1 text-success w-100" id="validation-confirmation"><i class="fa fa-check-circle"></i> Email changed successfully</div>
                                                                        {% endif %}
                                                                        <div class="invalid-feedback"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> Error in email change</div>
                                                                            </div>
                                                                            </form>
                                                                            <div class="row justify-content-start">
                                                                                <div class="btn-row col-md-10">
                                                                                    <a class="btn btn-primary rounded-0" href="{% url 'password_change' %}">Change Password</a>
                                                                                        </div>
                                                                                        </div>
                                                                                        </div>
                                                                                        <div class="col-10">
                                                                                            <hr>
                                                                                            </div>
                                                                                            </div>
                                                                                            </div>
                                                                                            {% include "account/_contributions.html" %}
                                                                                            <div class="tab-pane fade{% if active_tab == 'recent' %} show active{% endif %}" id="recent" role="tabpanel" aria-labelledby="recent-tab">
                                                                                                <div class="row justify-content-start" id="recent-pages"></div>
                                                                                                    </div>
                                                                                                    </div>
                                                                                                    </div>
{% endblock main_content %}

{% block body_scripts %}
    <script type="module" src="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/duet.esm.js"></script>
        <script nomodule src="https://cdn.jsdelivr.net/npm/@duetds/date-picker@1.4.0/dist/duet/duet.js"></script>
            {{ block.super }}
            <script src="{% static 'js/campaign-selection.js' %}"></script>
                <script src="{% static 'js/recent-pages.js' %}"></script>
                    <script type="text/javascript">
                        function sortDateAscending() {
                        var urlParameters = new URLSearchParams(window.location.search);
                        urlParameters.set('order_by', 'date-ascending');
                        getPages('?' + urlParameters.toString());
                        }

                        function sortDateDescending() {
                        var urlParameters = new URLSearchParams(window.location.search);
                        urlParameters.set('order_by', 'date-descending');
                        getPages('?' + urlParameters.toString());
                        }
                        $(document).ready(function() {
                        {% if active_tab and active_tab == "recent" %}
                            getPages();
                        {% endif %}
                        if (window.location.hash != "") {
                            $('a[href="' + window.location.hash + '"]').click();
                                if (window.location.hash == "#recent") {
                                    getPages();
                                    }
                                    }
                                    });
                                    // Disable form submissions, if there are invalid fields
                                    (function() {
                                    'use strict';
                                    window.addEventListener('load', function() {
                                    // Fetch all the forms we want to apply custom Bootstrap validation styles to
                                    var forms = document.getElementsByClassName('needs-validation');
                                    // Loop over them and prevent submission
                                    var validation = Array.prototype.filter.call(forms, function(form) {
                                    form.addEventListener('submit', function(event) {
                                    $('#validation-confirmation').hide();
                                    if (form.checkValidity() === false) {
                                    event.preventDefault();
                                    event.stopPropagation();
                                    }
                                    form.classList.add('was-validated');
                                    }, false);
                                    });
                                    }, false);
                                    })();
                                    </script>
{% endblock body_scripts %}
